<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="/css/globals.css" />
    <link rel="stylesheet" href="/css/styleguide.css" />
    <link rel="stylesheet" href="/css/style.css" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  </head>

  <body>
    

 <!-- NAVBAR -->
<nav class="navbar navbar-expand-lg bg-light border-bottom py-3">
    <div class="container">
        <a class="navbar-brand fw-bold" href="#">Ecommerce</a>

        <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navMenu">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div id="navMenu" class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto ms-4 gap-3">
                <li class="nav-item"><a class="nav-link" href="/shop">Home</a></li>

                <li class="nav-item ">
                    <a class="nav-link active" href="/shop">Shop</a>
                </li>

                <li class="nav-item"><a class="nav-link" href="/blogs">Blogs</a></li>
                <li class="nav-item"><a class="nav-link" href="/forum">Forum</a></li>
                <li class="nav-item"><a class="nav-link" href="/sitemap">Site Map</a></li>
            </ul>

            <form class="d-flex me-3">
                <input class="form-control" type="search" placeholder="Search products">
            </form>

          <a href="/cart" class="me-3"><i class="fa-solid fa-bag-shopping fs-5"></i></a>
          <a href="/login"><i class="fa-regular fa-user fs-5"></i></a>
        </div>
    </div>
</nav>
     <!-- BREADCRUMB -->
<nav class="bg-light py-2 border-bottom">
    <div class="container">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="#">Ecommerce</a></li>
            <li class="breadcrumb-item active">Shop</li>
        </ol>
    </div>
</nav>

<!-- PRODUCTS SECTION -->

<div class="products">
  
  <aside class="filter-sidebar">
    
    <div class="filter-section mt-4 pt-4 border-top">
      <h6 class="fw-bold mb-3">Color</h6>
      <div class="d-flex gap-2 flex-wrap">
        
        <label class="color-option">
          <input type="radio" name="color-filter" value="green">
          <span class="swatch" style="background-color: #4CAF50;"></span> 
        </label>

        <label class="color-option">
          <input type="radio" name="color-filter" value="gray">
          <span class="swatch" style="background-color: #808080;"></span> 
        </label>

        <label class="color-option">
          <input type="radio" name="color-filter" value="blue">
          <span class="swatch" style="background-color: #0d6efd;"></span> 
        </label>
        
        <a href="/shop" class="text-muted small text-decoration-none ms-2 align-self-center">Clear</a>
      </div>
    </div>

    <div class="filter-section mt-4 pt-4 border-top">
      <h6 class="fw-bold mb-3">Size</h6>
      <div class="d-flex gap-2 flex-wrap">
        <label class="size-option"><input type="radio" name="size-filter" value="39"><span class="box">39</span></label>
        <label class="size-option"><input type="radio" name="size-filter" value="40"><span class="box">40</span></label>
        <label class="size-option"><input type="radio" name="size-filter" value="41"><span class="box">41</span></label>
        <label class="size-option"><input type="radio" name="size-filter" value="42"><span class="box">42</span></label>
        <label class="size-option"><input type="radio" name="size-filter" value="43"><span class="box">43</span></label>
      </div>
    </div>

    <div class="filter-section mt-4 pt-4 border-top">
      <h6 class="fw-bold mb-3">Max Price</h6>
      <label class="form-label small text-muted">Up to: $<span id="priceValue">300</span></label>
      <input type="range" class="form-range" id="priceRange" min="0" max="300" value="300">
    </div>

</aside>

  <div class="result-count-sort">
    <span class="text-secondary small fw-bold">Showing 1-3 Of 3 Results.</span>

   <select id="sortSelect" class="form-select form-select-sm border-0 fw-bold" style="width: auto; cursor: pointer;">
    <option value="default">Sort By</option>
    <option value="price_low">Price: Low to High</option>
    <option value="price_high">Price: High to Low</option>
    <option value="name_asc">Name: A to Z</option>
</select> 
  </div>

  <div class="applied-filters">
    <span class="small fw-bold">Applied Filters:</span>
    <span class="badge rounded-pill border text-dark bg-white fw-normal pe-1">
      Shoes <i class="fa-solid fa-xmark ms-2 text-secondary cursor-pointer"></i>
    </span>
    <span class="badge rounded-pill border text-dark bg-white fw-normal pe-1">
      Mens <i class="fa-solid fa-xmark ms-2 text-secondary cursor-pointer"></i>
    </span>
  </div>


<div class="div-2">
  <% products.forEach(function(product) { %>

    <div class="product-card-wrapper" 
         data-name="<%= product.name.toLowerCase() %>" 
         data-price="<%= product.price %>"
         data-category="<%= product.category %>">

        <div class="product-card">
          
          <a href="/product?id=<%= product.id %>" class="text-decoration-none">
            <img class="image" src="<%= product.image %>" alt="<%= product.name %>" />
          </a>

          <div class="detail">
            
            <a href="/product?id=<%= product.id %>" class="text-decoration-none text-dark">
               <h6 class="fw-bold mb-1"><%= product.name %></h6>
            </a>

            <div class="d-flex align-items-center gap-2">
              <span class="badge rounded-pill border fw-normal text-dark"><%= product.stock %></span>
              <span class="text-secondary small">$<%= product.price %></span>
            </div>
            
            <form action="/add-to-cart" method="POST" class="mt-2" 
      data-sizes="<%= (product.sizes || [39,40,41,42,43]).join(',') %>">
                <input type="hidden" name="productId" value="<%= product.id %>">
                <button type="submit" class="btn btn-sm btn-dark w-100">Add to Cart</button>
            </form>

          </div>
        </div>

    </div>

  <% }); %>
</div>


  <div class="pagination-area d-flex justify-content-center mt-5">
    <nav aria-label="Page navigation">
      <ul class="pagination gap-2">
        <li class="page-item">
          <a class="page-link border rounded text-dark" href="#" aria-label="Previous">
            <i class="fa-solid fa-chevron-left small"></i>
          </a>
        </li>
        <li class="page-item"><a class="page-link border rounded text-dark bg-light fw-bold" href="#">1</a></li>
        <li class="page-item disabled"><span class="page-link border-0 text-dark">...</span></li>
        <li class="page-item">
          <a class="page-link border rounded text-dark" href="#" aria-label="Next">
            <i class="fa-solid fa-chevron-right small"></i>
          </a>
        </li>
      </ul>
    </nav>
  </div>

</div>
      <!-- FOOTER -->
<footer class="bg-light pt-5 mt-0">
  <div class="container">

    <div class="row">
      <!-- Column 1: Logo + Social -->
      <div class="col-md-3 mb-4">
        <div class="d-flex align-items-center gap-2 mb-2">
          <div class="p-2 border rounded"><i class="fa-solid fa-store fs-3"></i></div>
          <span class="fw-bold fs-5">Ecommerce</span>
        </div>
        <p class="text-muted small">DevCut is a YouTube channel for practical project-based learning.</p>
        <div class="d-flex gap-2 mt-2">
            <i class="fab fa-github fs-5"></i>
            <i class="fab fa-instagram fs-5"></i>
            <i class="fab fa-youtube fs-5"></i>
        </div>
      </div>
        

      <!-- Column 2: Shop -->
      <div class="col-md-2 mb-4">
        <h6 class="text-muted">SHOP</h6>
        <ul class="list-unstyled mt-2">
          <li><a href="#" class="text-decoration-none text-dark">My Account</a></li>
          <li><a href="#" class="text-decoration-none text-dark">Checkout</a></li>
          <li><a href="#" class="text-decoration-none text-dark">Cart</a></li>
        </ul>
      </div>

      <!-- Column 3: Company -->
      <div class="col-md-2 mb-4">
        <h6 class="text-muted">COMPANY</h6>
        <ul class="list-unstyled mt-2">
          <li><a href="#" class="text-decoration-none text-dark">About us</a></li>
          <li><a href="#" class="text-decoration-none text-dark">Contact</a></li>
          <li><a href="#" class="text-decoration-none text-dark">Careers</a></li>
        </ul>
      </div>

      <!-- Column 4: Support -->
      <div class="col-md-2 mb-4">
        <h6 class="text-muted">SUPPORT</h6>
        <ul class="list-unstyled mt-2">
          <li><a href="#" class="text-decoration-none text-dark">FAQ</a></li>
          <li><a href="#" class="text-decoration-none text-dark">Terms of use</a></li>
          <li><a href="#" class="text-decoration-none text-dark">Privacy Policy</a></li>
        </ul>
      </div>

      <!-- Column 5: Payments -->
        <div class="col-md-3 mb-4">
            <h6 class="text-muted">ACCEPTED PAYMENTS</h6>
            <div class="d-flex gap-2 mt-2">
                <i class="fa-brands fa-cc-visa fs-3"></i>
                <i class="fa-brands fa-cc-mastercard fs-3"></i>
                <i class="fa-brands fa-cc-amex fs-3"></i>
                <i class="fa-brands fa-cc-paypal fs-3"></i>
            </div>
        </div>
      
    </div>

    

    <hr class="mt-4">

    <!-- Copyright -->
    <div class="text-center pb-3 small text-muted">
      Â© 2023 DevCut. All rights reserved.
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // 1. SELECT ELEMENTS
    const searchInput = document.querySelector('input[type="search"]');
    const productCards = document.querySelectorAll('.product-card-wrapper');

    // 2. CRITERIA: WEB STORAGE API
    // Check if user typed something before refresh
    const savedSearch = localStorage.getItem('userSearch');
    if (savedSearch) {
        searchInput.value = savedSearch;
        filterProducts(savedSearch); // Run filter immediately
    }

    // 3. CRITERIA: TEXT SEARCH SYSTEM
    searchInput.addEventListener('input', function(e) {
        const searchText = e.target.value.toLowerCase();
        
        // Save to storage
        localStorage.setItem('userSearch', searchText);
        
        // Run filter
        filterProducts(searchText);
    });

    function filterProducts(text) {
        productCards.forEach(card => {
            // Get the name we hid in the data-name attribute
            const productName = card.getAttribute('data-name');
            
            if (productName.includes(text)) {
                card.style.display = "block"; // Show
            } else {
                card.style.display = "none";  // Hide
            }
        });
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    // 1. Find every "Add to Cart" form
    const allForms = document.querySelectorAll('form[action="/add-to-cart"]');

    allForms.forEach(form => {
        form.addEventListener('submit', async function(event) {
            event.preventDefault(); // Stop page reload

            // Get the available sizes for THIS specific product
            const sizesAttr = form.getAttribute('data-sizes');
            const sizes = sizesAttr ? sizesAttr.split(',') : ['39','40','41','42','43'];
            
            // Generate the HTML for the Size Dropdown options
            const sizeOptions = sizes.map(s => `<option value="${s}">${s}</option>`).join('');

            // STEP 1: ASK FOR SIZE & QUANTITY
            const { value: formValues } = await Swal.fire({
                title: 'Select Options',
                html: `
                    <div style="text-align: left;">
                        <label class="fw-bold">Size:</label>
                        <select id="swal-size" class="form-select mb-3">
                            ${sizeOptions}
                        </select>

                        <label class="fw-bold">Quantity:</label>
                        <input id="swal-qty" type="number" class="form-control" value="1" min="1">
                    </div>
                `,
                focusConfirm: false,
                confirmButtonText: 'Add to Cart',
                confirmButtonColor: '#212529',
                showCancelButton: true,
                preConfirm: () => {
                    return {
                        size: document.getElementById('swal-size').value,
                        quantity: document.getElementById('swal-qty').value
                    }
                }
            });

            // If user clicked "Add to Cart" (and didn't cancel)
            if (formValues) {
                
                // Prepare the data to send
                const formData = new FormData(form);
                formData.append('size', formValues.size);
                formData.append('quantity', formValues.quantity);
                const data = Object.fromEntries(formData.entries());

                try {
                    // STEP 2: SEND TO SERVER
                    const response = await fetch('/add-to-cart', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: new URLSearchParams(data)
                    });

                    const result = await response.json();

                    if (result.success) {
                        // STEP 3: SHOW SUCCESS POPUP
                        Swal.fire({
                            title: 'Added to Cart!',
                            text: `Added Size ${formValues.size} (Qty: ${formValues.quantity})`,
                            icon: 'success',
                            showCancelButton: true,
                            confirmButtonColor: '#212529',
                            cancelButtonColor: '#d33',
                            confirmButtonText: 'Go to Cart',
                            cancelButtonText: 'Continue Shopping'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                window.location.href = '/cart';
                            }
                        });
                    } else {
                        Swal.fire('Error', result.message, 'error');
                    }

                } catch (error) {
                    console.error('Error:', error);
                    Swal.fire('Error', 'Something went wrong!', 'error');
                }
            }
        });
    });
</script>

<script>
        const sortSelect = document.getElementById('sortSelect');
        const priceRange = document.getElementById('priceRange');
        const priceValue = document.getElementById('priceValue');
        
        // Select all radio buttons for color and size
        const colorInputs = document.querySelectorAll('input[name="color-filter"]');
        const sizeInputs = document.querySelectorAll('input[name="size-filter"]');

        function updateFilters() {
            const sort = sortSelect.value;
            const maxPrice = priceRange.value;

            // Find which Color and Size are checked
            const selectedColor = document.querySelector('input[name="color-filter"]:checked')?.value;
            const selectedSize = document.querySelector('input[name="size-filter"]:checked')?.value;

            // Build the URL
            let url = `/shop?sort=${sort}&maxPrice=${maxPrice}`;
            if (selectedColor) url += `&color=${selectedColor}`;
            if (selectedSize) url += `&size=${selectedSize}`;

            window.location.href = url;
        }

        // Add Listeners
        sortSelect.addEventListener('change', updateFilters);
        priceRange.addEventListener('change', updateFilters);
        
        // Add listeners to every Color and Size button
        colorInputs.forEach(input => input.addEventListener('change', updateFilters));
        sizeInputs.forEach(input => input.addEventListener('change', updateFilters));

        // Visual update for slider
        priceRange.addEventListener('input', () => { priceValue.textContent = priceRange.value; });

        // Restore State on Reload (Keep buttons checked)
        const urlParams = new URLSearchParams(window.location.search);
        
        if (urlParams.has('sort')) sortSelect.value = urlParams.get('sort');
        if (urlParams.has('maxPrice')) {
            priceRange.value = urlParams.get('maxPrice');
            priceValue.textContent = urlParams.get('maxPrice');
        }
        // Re-check the color/size boxes based on URL
        if (urlParams.has('color')) {
            const colorBtn = document.querySelector(`input[value="${urlParams.get('color')}"]`);
            if (colorBtn) colorBtn.checked = true;
        }
        if (urlParams.has('size')) {
            const sizeBtn = document.querySelector(`input[value="${urlParams.get('size')}"]`);
            if (sizeBtn) sizeBtn.checked = true;
        }
    </script>
</body>
</html>